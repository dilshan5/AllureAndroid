desc "Run UI Tests"
private_lane :ui_test do |options|
    matrix_emulator = options[:matrix_emulator] ? options[:matrix_emulator] : 'pixel_xl'
    matrix_api = options[:matrix_api] ? options[:matrix_api] : '32'
    matrix_test_suite = options[:matrix_test_suite] ? options[:matrix_test_suite] : 'Smoke'
    matrix_env = options[:matrix_env] ? options[:matrix_env] : 'dev'

    ENV["API"] = options[:matrix_api] ? options[:matrix_api] : '32'
    ENV["EMULATOR"] = options[:matrix_emulator] ? options[:matrix_emulator] : 'pixel_3a'

     begin
        start_emulators("google_pixel_xl;google_nexus")
        wait_for_emulators_to_boot
        task = "app:connectedDebugAndroidTest"
        executeGradle(task)
     rescue
        close_emulators
        #executeGradle('cleanOutput')
     end

end
